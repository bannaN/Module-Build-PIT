use 5.006;
use strict;
use warnings FATAL => 'all';
use Module::Build;

my $class = Module::Build->subclass(code => q{

sub installtests_map{
  my $self = shift;
  use Data::Dumper;
  
  my $share_dir = $self->share_dir;
  return unless $share_dir;
  
  
  my $dirs = (ref($share_dir->{tests}) eq 'ARRAY') ? $share_dir->{tests} : [$share_dir->{tests}];
  my $prefix = File::Spec->catdir($self->install_base, qw/lib auto share tests/);
  print Dumper $dirs;
  
  my $install_map = {};
  
  #print "\n\n-->" . $self->destdir() . "<---\n\n";
  #print "\n\n-->" .  $self->prefix . "<---\n\n";
  #print "\n\n-->" . $self->install_base . "<---\n\n";
  
  for my $dir ( @{ $dirs } ) {
    $install_map->{ File::Spec->catdir($dir)} = File::Spec->catdir($prefix, $self->dist_name() . "-" . $self->dist_version(), $dir);
  }
  
  
  return $install_map;
}

sub ACTION_fakeinstalltests{
  my $self = shift;
  require ExtUtils::Install;
  my $eui_version = ExtUtils::Install->VERSION;
  if ( $eui_version < 1.32 ) {
    $self->log_warn(
      "The 'fakeinstalltests' action requires Extutils::Install 1.32 or later.\n"
      . "(You only have version $eui_version)."
    );
    return;
  }  
  ExtUtils::Install::install($self->installtests_map, !$self->quiet, 1, $self->{args}{uninst}||0);
}

sub ACTION_installtests{
  my $self = shift;
  require ExtUtils::Install;

  
  $self->_do_in_dir( ".", sub {
    ExtUtils::Install::install(
      $installtests_map, $self->verbose, 0, $self->{args}{uninst}||0
    );
  });
}
sub ACTION_fakeinstall{
  my $self = shift;
  use Data::Dumper;
  print Dumper $self->install_map();
}
});

my $builder = $class->new(
    module_name         => 'Human',
    license             => 'restrictive',
    dist_author         => q{Joakim TÃ¸rmoen <joakim.tormoen@evry.com>},
    dist_version_from   => 'lib/Human.pm',
    dist_abstract       => 'A module representive a primitive human',
    release_status      => 'stable',
    configure_requires => {
        'Module::Build' => 0,
    },
    build_requires => {
        'Test::More' => 0,
        'Test::Warn' => 0,
        'File::Copy::Recursive' => 0
    },
    requires => {
      'version' => 0,
      'Bear' => '>= 0.01',
    },
    share_dir => {
      tests => 't', #Name of your test catalog under base_dir. Usually t. You can also specify several folders ['t', 'foo', 'bar']
      #tests => ['t', 'foo', 'bar']
    },
    add_to_cleanup     => [ 'Human-*' ],
    create_makefile_pl => 'traditional',
);

$builder->create_build_script();
